<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 700 450">
  <defs>
    <marker id="arrow-gray" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="var(--diagram-arrow, #9eadb6)"/>
    </marker>
    <marker id="arrow-border" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="var(--diagram-border, #0e3d54)"/>
    </marker>
  </defs>

  <!-- Outer Frame (Acceptance Loop) -->
  <rect x="20" y="20" width="660" height="410" rx="15"
        fill="var(--diagram-bg-alt, #f8fafc)"
        stroke="var(--diagram-border, #0e3d54)"
        stroke-width="3"/>
  <text x="350" y="50" text-anchor="middle"
        font-family="system-ui, sans-serif" font-size="16" font-weight="700"
        fill="var(--diagram-border, #0e3d54)">OUTER LOOP (Acceptance)</text>

  <!-- Inner Frame (Content) -->
  <rect x="50" y="70" width="600" height="320" rx="10"
        fill="var(--diagram-bg, #ffffff)"
        stroke="var(--diagram-arrow, #9eadb6)"
        stroke-width="2"/>

  <!-- Acceptance Test RED -->
  <rect x="80" y="100" width="140" height="60" rx="8"
        fill="var(--diagram-red-bg, #fef2f2)"
        stroke="var(--diagram-red-border, #ef4444)"
        stroke-width="2"/>
  <text x="150" y="125" text-anchor="middle"
        font-family="system-ui, sans-serif" font-size="13" font-weight="600"
        fill="var(--diagram-red-text, #dc2626)">Acceptance Test</text>
  <text x="150" y="145" text-anchor="middle"
        font-family="system-ui, sans-serif" font-size="12"
        fill="var(--diagram-red-text, #dc2626)">(RED)</text>

  <!-- Arrow to Inner Loop -->
  <path d="M 220 130 L 260 130" stroke="var(--diagram-border, #0e3d54)"
        stroke-width="2" fill="none" marker-end="url(#arrow-border)"/>

  <!-- Inner Loop Box -->
  <rect x="270" y="90" width="300" height="200" rx="12"
        fill="var(--diagram-bg-alt, #f8fafc)"
        stroke="var(--diagram-border, #0e3d54)"
        stroke-width="2"/>
  <text x="420" y="115" text-anchor="middle"
        font-family="system-ui, sans-serif" font-size="14" font-weight="700"
        fill="var(--diagram-border, #0e3d54)">INNER LOOP (Unit TDD)</text>

  <!-- RED box in inner -->
  <rect x="300" y="135" width="70" height="45" rx="6"
        fill="var(--diagram-red-bg, #fef2f2)"
        stroke="var(--diagram-red-border, #ef4444)"
        stroke-width="2"/>
  <text x="335" y="163" text-anchor="middle"
        font-family="system-ui, sans-serif" font-size="13" font-weight="600"
        fill="var(--diagram-red-text, #dc2626)">RED</text>

  <!-- Arrow RED to GREEN -->
  <path d="M 370 158 L 390 158" stroke="var(--diagram-arrow, #9eadb6)"
        stroke-width="2" fill="none" marker-end="url(#arrow-gray)"/>

  <!-- GREEN box in inner -->
  <rect x="400" y="135" width="80" height="45" rx="6"
        fill="var(--diagram-green-bg, #f0fdf4)"
        stroke="var(--diagram-green-border, #22c55e)"
        stroke-width="2"/>
  <text x="440" y="163" text-anchor="middle"
        font-family="system-ui, sans-serif" font-size="13" font-weight="600"
        fill="var(--diagram-green-text, #16a34a)">GREEN</text>

  <!-- Arrow GREEN to REFACTOR -->
  <path d="M 440 180 L 440 200" stroke="var(--diagram-arrow, #9eadb6)"
        stroke-width="2" fill="none" marker-end="url(#arrow-gray)"/>

  <!-- REFACTOR box in inner -->
  <rect x="380" y="210" width="100" height="45" rx="6"
        fill="var(--diagram-yellow-bg, #fefce8)"
        stroke="var(--diagram-yellow-border, #f59e0b)"
        stroke-width="2"/>
  <text x="430" y="238" text-anchor="middle"
        font-family="system-ui, sans-serif" font-size="13" font-weight="600"
        fill="var(--diagram-yellow-text, #d97706)">REFACTOR</text>

  <!-- Arrow REFACTOR back to RED -->
  <path d="M 380 232 Q 310 232 310 200 Q 310 175 300 175"
        stroke="var(--diagram-arrow, #9eadb6)"
        stroke-width="2" fill="none"/>
  <path d="M 300 175 L 300 158" stroke="var(--diagram-arrow, #9eadb6)"
        stroke-width="2" fill="none" marker-end="url(#arrow-gray)"/>

  <!-- Repeat label for inner -->
  <text x="420" y="270" text-anchor="middle"
        font-family="system-ui, sans-serif" font-size="11" font-style="italic"
        fill="var(--diagram-arrow, #9eadb6)">(repeat for each unit needed)</text>

  <!-- Arrow from Inner Loop to Acceptance GREEN -->
  <path d="M 420 290 L 420 320" stroke="var(--diagram-border, #0e3d54)"
        stroke-width="2" fill="none" marker-end="url(#arrow-border)"/>

  <!-- Acceptance Test GREEN -->
  <rect x="280" y="330" width="280" height="50" rx="8"
        fill="var(--diagram-green-bg, #f0fdf4)"
        stroke="var(--diagram-green-border, #22c55e)"
        stroke-width="2"/>
  <text x="420" y="360" text-anchor="middle"
        font-family="system-ui, sans-serif" font-size="14" font-weight="600"
        fill="var(--diagram-green-text, #16a34a)">Acceptance Test (GREEN)</text>

  <!-- Repeat label for outer -->
  <text x="350" y="410" text-anchor="middle"
        font-family="system-ui, sans-serif" font-size="12" font-style="italic"
        fill="var(--diagram-arrow, #9eadb6)">(repeat for each scenario)</text>
</svg>